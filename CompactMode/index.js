(function(d,I,l,r,a,b,k,x,h){"use strict";const{ScrollView:S}=x.General,{TableRowGroup:O,TableSwitchRow:m,TableRowIcon:f}=l.findByProps("TableRowGroup");function _(){k.useProxy(a.storage);const t=r.React.createElement(f,{source:h.getAssetIDByName("ic_my_account_24px"),variant:"blurple"}),e=r.React.createElement(f,{source:h.getAssetIDByName("ic_clear_all_24px"),variant:"blurple"}),n=r.React.createElement(f,{source:h.getAssetIDByName("clock"),variant:"blurple"});return r.React.createElement(S,{style:{flex:1}},r.React.createElement(O,null,r.React.createElement(m,{label:"Show Avatars",subLabel:"Only works on iOS due to Android regrabbing emote URLs.",icon:t,disabled:r.ReactNative.Platform.OS=="android",value:a.storage.avatars??!1,onValueChange:function(c){return a.storage.avatars=c}}),r.React.createElement(m,{label:"No Inline Header",subLabel:"Puts header on a new line.",icon:e,value:a.storage.noInline??!1,onValueChange:function(c){return a.storage.noInline=c}}),r.React.createElement(m,{label:"Full Inline Timestamps",subLabel:"Shows un-truncated inline timestamps. Supports Custom Timestamps.",icon:n,value:a.storage.inlineTimestamps??!1,onValueChange:function(c){return a.storage.inlineTimestamps=c}}),r.React.createElement(m,{label:"Hide Reply Avatars",icon:t,value:a.storage.noReplyAvatars??!1,onValueChange:function(c){return a.storage.noReplyAvatars=c}})))}const T=l.findByName("RowManager");l.findByProps("int2hex");const A=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:E}}=l.findByProps("colors","meta"),N=l.findByStoreName("GuildMemberStore"),w=l.findByStoreName("GuildStore"),p=l.findByProps("parseToAST");function B(t,e){const n=[],c=t.tagBackgroundColor??r.ReactNative.processColor(b.rawColors.BRAND_500),s=r.ReactNative.processColor(E(A.theme,b.semanticColors.TEXT_MUTED)),u=N.getMember(t.guildId,e.author.id),o=w.getGuild(t.guildId);if(e.timestamp&&!a.storage.noInline&&(n.push({content:[{content:a.storage.inlineTimestamps?e.__customTimestamp??e.timestamp.calendar():e.timestamp.format("HH:mm:ss"),type:"inlineCode"}],type:"link",target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:s,messageChannelId:"0"},medium:!0}}),n.push({content:" ",type:"text"})),(a.storage.avatars??!1)&&r.ReactNative.Platform.OS!="android"&&e.author.avatar!=null){let i=`https://cdn.discordapp.com/avatars/${e.author.id}/${e.author.avatar}.${e.author.avatar.startsWith("a_")?"gif":"png"}?size=128`;u?.avatar&&(i=`https://cdn.discordapp.com/guilds/${t.guildId}/users/${t.authorId}/avatars/${u.avatar}.${u.avatar.startsWith("a_")?"gif":"png"}?size=128`);const y={id:e.author.id,alt:"Avatar for: "+t.username,src:i,frozenSrc:i,type:"customEmoji"};n.push(y),n.push({content:" ",type:"text"})}t.tagText&&!a.storage.noInline&&(n.push({content:[{content:t.tagText,type:"inlineCode"}],type:"link",target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:c,messageChannelId:"0"},medium:!0}}),n.push({content:" ",type:"text"}));let g=t.username;t.username==e.author.username&&(g=e.nick??e.author.globalName??t.username);const C={content:[{content:[{content:g,type:"text"}],type:"strong"}],type:"link",target:"usernameOnClick",context:{username:!0,usernameOnClick:{action:"bindTapUsername",userId:e.author.id,linkColor:e.colorString?r.ReactNative.processColor(e.colorString):t.usernameColor,messageChannelId:t.channelId}}};if(n.push(C),u?.iconRoleId&&a.storage.noInline){const i=o.roles[u.iconRoleId];if(i.unicodeEmoji)n.push({content:" ",type:"text"}),n.push(p.parseToAST(i.unicodeEmoji)[0]);else if(i.icon&&r.ReactNative.Platform.OS!="android"){const y=`https://cdn.discordapp.com/role-icons/${t.guildId}/${i.icon}.webp?size=20`;n.push({content:" ",type:"text"}),n.push({id:i.id,alt:i.name,src:y,frozenSrc:y,type:"customEmoji"})}}return t.tagText&&a.storage.noInline&&(n.push({content:" ",type:"text"}),n.push({content:[{content:t.tagText,type:"inlineCode"}],type:"link",target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:c,messageChannelId:"0"},medium:!0}})),e.timestamp&&a.storage.noInline&&(n.push({content:" ",type:"text"}),n.push({content:[{content:e.__customTimestamp??e.timestamp.calendar(),type:"inlineCode"}],type:"link",target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:s,messageChannelId:"0"},medium:!0}})),n}function R(t){for(const e of t)e.type=="emoji"||e.type=="customEmoji"?e.jumboable=!1:Array.isArray(e.content)&&R(e.content)}const v=[],U=function(){v.push(I.before("generate",T.prototype,function(t){let[e]=t;e.vd_cm_realIsFirst=e.isFirst,e.isFirst=!1,e.message&&(e.message.avatarURL=void 0)})),v.push(I.after("generate",T.prototype,function(t,e){let[n]=t;if(n.rowType!==1)return;const c=n.message,{message:s}=e;if(s.type!=0&&s.type!=19||(e.renderContentOnly=!0,s.avatarURL=void 0,a.storage.noInline&&!n.vd_cm_realIsFirst))return;const u=B(s,c);if(s.content&&u.push({content:a.storage.noInline?`
`:" ",type:"text"}),s.content=[...u,...s.content??[]],a.storage.noInline||R(s.content),s.referencedMessage?.message&&a.storage.noReplyAvatars){const o=s.referencedMessage.message;o.avatarURL=void 0;const g={content:[{content:[{content:o.username,type:"text"}],type:"strong"}],type:"link",target:"usernameOnClick",context:{username:!0,usernameOnClick:{action:"bindTapUsername",userId:o.authorId,linkColor:o.usernameColor,messageChannelId:o.channelId}}};if(s.referencedMessage.systemContent){const C=s.referencedMessage.systemContent;delete s.referencedMessage.systemContent,o.content||(o.content=[{content:[{content:C,type:"text"}],type:"em"}]),o.attachments?.length>0?o.content=[...o.content,{content:" ",type:"text"},p.parseToAST("\u{1F5BC}")[0]]:o.stickers?.length>0?o.content=[...o.content,{content:" ",type:"text"},p.parseToAST("\u2728")[0]]:o.embeds?.length>0&&(o.content=[...o.content,{content:" ",type:"text"},p.parseToAST("\u{1F5D2}")[0]])}o.content=[g,{content:" ",type:"text"},...o.content??[]]}}))},$=function(){for(const t of v)t?.()};return d.onLoad=U,d.onUnload=$,d.settings=_,d})({},vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.plugin,vendetta.ui,vendetta.storage,vendetta.ui.components,vendetta.ui.assets);
